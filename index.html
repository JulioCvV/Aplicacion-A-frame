<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" media="screen" href="resources/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-timeline-component@1.6.0/dist/aframe-animation-timeline-component.min.js"></script> 
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="resources/a_frame_script.js"></script>
    <script defer src="resources/main_script.js" type="text/javascript"></script>
    <title>Entorno virtual ExpM</title>
</head>
<body>
    <a-scene escena sonido_ambiente controles-informacion background="color: #FFFFFF" light="defaultLightsEnabled: false" fog="none" cursor="rayOrigin: mouse" animation-timeline__A="timeline:#trucksTimeline; loop:true">
        
        <!-- Assets manager -->
        <a-assets>
            <!-- Modelos -->
            <a-asset-item id="player" src="resources/Models/Avatar_animado.glb"></a-asset-item>
            <a-asset-item id="npc" src="resources/Models/NPC.glb"></a-asset-item>
            <a-asset-item id="entorno" src="resources/Models/Entorno.glb"></a-asset-item>
            <a-asset-item id="fabrica" src="resources/Models/Fabrica.glb"></a-asset-item>
            <a-asset-item id="extras" src="resources/Models/Extras.glb"></a-asset-item>
            <a-asset-item id="letrero_01" src="resources/Models/Letrero_01.glb"></a-asset-item>
            <a-asset-item id="letrero_02" src="resources/Models/Letrero_02.glb"></a-asset-item>
            <a-asset-item id="torre" src="resources/Models/Torre.glb"></a-asset-item>
            <a-asset-item id="luces_torre" src="resources/Models/Luces_torre.glb"></a-asset-item>
            <a-asset-item id="tanque_01" src="resources/Models/Tanque_01.glb"></a-asset-item>
            <a-asset-item id="tanque_02" src="resources/Models/Tanque_02.glb"></a-asset-item>
            <a-asset-item id="tanque_03" src="resources/Models/Tanque_03.glb"></a-asset-item>
            <a-asset-item id="camion" src="resources/Models/Camion.glb"></a-asset-item>

            <!-- Navigation mesh -->
            <a-asset-item id="navigation_mesh" src="resources/Models/NavMesh_ext.glb"></a-asset-item>

            <!-- Imagen del portal -->
            <img id="entrada" src="resources/Textures/Room.jpg">

            <!-- Audio -->
            <audio id="andando" src="resources/Audio_files/Motor_de_camion.ogg" preload="auto"></audio>
            <audio id="parqueo" src="resources/Audio_files/Parqueo.ogg" preload="auto"></audio>
            <audio id="encendido" src="resources/Audio_files/Encendido_de_camion.ogg" preload="auto"></audio>
            <audio id="apagado" src="resources/Audio_files/Motor_apagado.ogg" preload="auto"></audio>

            <!-- Animaciones de los camiones -->
            <a-timeline id="trucksTimeline">

                <a-timeline-group>
                    <a-timeline-animation select="#camion_02" name="drive"></a-timeline-animation>
                    <a-timeline-animation select="#camion_02" name="turning"></a-timeline-animation>
                </a-timeline-group>
                <a-timeline-animation select="#camion_02" name="park"></a-timeline-animation>

                <a-timeline-group>
                    <a-timeline-animation select="#camion_01" name="depart" offset="2000"></a-timeline-animation>
                    <a-timeline-animation select="#camion_01" name="turn"></a-timeline-animation>
                </a-timeline-group>
                <a-timeline-animation select="#camion_01" name="go"></a-timeline-animation>
                
            </a-timeline>
        </a-assets>

        <!-- Forma número 1 para el personaje -->
        <!-- <a-entity id="rig" position ="0 1.6 0" rotation="0 0 0">
            <a-entity id="camera" camera look-controls wasd-controls="acceleration:24">
                <a-entity 
                id="character"
                geometry="primitive: sphere; radius: 1" 
                position="0 -1 -3"
                material="color: gray;">
                </a-entity>
            </a-entity>
        </a-entity> -->

        <!-- Forma número 2 para el personaje -->
        <!-- <a-entity id="character" geometry="primitive: sphere; radius: 1" position="0 1 0" player_controls="flyEnabled: true; turnEnabled: true; lookEnabled: true; maxLookAngle: 60;" material="color: gray">
            <a-entity id="rig" position="0 1 3">
                <a-entity id="camera" camera ></a-entity>
            </a-entity>
        </a-entity> -->

        <!-- Funciona pero sin el navmesh -->
        <!-- <a-entity id="character" character gltf-model="#player" position="0 0 -65" scale="0.5 0.5 0.5" player_controls="turnEnabled: true;" animation-mixer="clip: Idle; loop: repeat">
            <a-entity id="rig" position="0 9 -25" rotation="0 180 0">
                <a-entity id="camera" camera="active:true; far: 1000; near: 0.1; fov: 50;" ></a-entity>
            </a-entity>
        </a-entity> -->

        <!-- Funciona el navmesh pero sin animaciones -->
        <!-- <a-entity id="character" character gltf-model="#player" position="0 0 -65" scale="0.5 0.5 0.5" movement-controls="controls:keyboard;constrainToNavMesh: true; speed: -0.3" animation-mixer="clip: Idle; loop: repeat">
            <a-entity id="rig" position="0 9 -25" rotation="0 180 0">
                <a-entity id="camera" camera="active:true; far: 1000; near: 0.1; fov: 50;" ></a-entity>
            </a-entity>
        </a-entity> -->

        <!-- Usuario -->
        <a-entity id="rig" position="0 0 -65" rotation="0 180 0" movement-controls="constrainToNavMesh: true; speed: 0.3">
            <a-entity id="camera" camera="active:true; far: 1000; near: 0.1; fov: 50;" position="0 4.3 0" look-controls></a-entity>
        </a-entity>

        <!-- Elementos del entorno -->
        <a-entity id="boss" gltf-model="#npc" character position="0 0 -14" rotation="0 180 0" scale="0.5 0.5 0.5" animation-mixer="clip: npc_idle; loop: repeat"></a-entity>
        <!-- <a-plane id="talkSign" position="0 5.5 -15" width="1" height="1" color="#FFFFFF" material="side: double" event-set__show="_event: click; color:#212327"></a-plane> -->
        <a-plane id="talkSign" look-at="#rig" talksign position="0 5.5 -14" width="1.5" height="1.5" color="#FFFFFF" material="side: double" onclick="show()" ></a-plane>
        <a-entity gltf-model="#entorno" entorno scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#fabrica" fabrica scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#extras" extras scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#letrero_01" letrero_01 scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#letrero_02" letrero_02 scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#torre" torre scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#luces_torre" luces_torre scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#tanque_01" tanque_01 scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#tanque_02" tanque_02 scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#tanque_03" tanque_03 scale="0.5 0.5 0.5" rotation="0 180 0"></a-entity>

        <!-- Camiones -->
        <a-entity id="camion_01" gltf-model="#camion" camion scale="0.5 0.5 0.5" position="-37.5 0 67" 
            sound__start="src: #encendido; loop: true; autoplay: false;refDistance: 5; volume: 1"
            sound__drive="src: #andando; loop: true; autoplay: true;refDistance: 5; volume: 1"
            animation__depart="property: position; dur: 4000;from: -37.5 0 67; to: -50 0 67;loop: 1; autoplay: false" 
            animation__turn="property: rotation; to: 0 -90 0;easing: linear; loop: 1; dur: 2000; autoplay: false"
            animation__go="property: position; dur: 10000;from: -50 0 67; to: -50 0 -85;easing: linear;loop: true; autoplay: false">
        </a-entity>

        <a-entity id="camion_02" gltf-model="#camion" camion sonido_camion scale="0.5 0.5 0.5" position="-50 0 -90" rotation="0 90 0" 
            sound__drive="src: #andando; loop: true; autoplay: true;refDistance: 5; volume: 1"
            sound__park="src: #parqueo; loop: true; refDistance: 5; volume: 1"
            animation__drive="property: position; dur: 10000;from: -60 0 -85; to: -60 0 75;easing: linear;loop: 1; autoplay: false"
            animation__turning="property: rotation;from: 0 90 0; to: 0 0 0;easing: linear; loop: 1; dur: 2000; autoplay: false"
            animation__park="property: position; dur: 4000;from: -60 0 75; to: -37.5 0 75;loop: 1; easing: easeOutQuad; autoplay: false">
        </a-entity>

        <a-entity id="camion_03" static-body="shape: box; mass: 2" gltf-model="#camion" camion scale="0.5 0.5 0.5" position="-37.5 0 91"></a-entity>
        <a-entity id="camion_04" gltf-model="#camion" camion scale="0.5 0.5 0.5" position="-37.5 0 83"></a-entity>

        <!-- Navigation mesh -->
        <a-entity gltf-model="#navigation_mesh" scale="0.5 0.5 0.5" nav-mesh visible="false"></a-entity>

        <!-- <a-link position="2 2 -12" href="inside.html" title="Entrada" image="#entrada" geometry="primitive: plane"></a-link> -->
        <!-- <a-entity  link="href: inside.html" geometry="primitive: plane; height: 6.5; width: 8.5" material="backgroundColor: #1a1a1a; blending: normal; borderEnabled: 0; pano: #entrada; shader: portal; side:double" position="-13.5 3.3 -6.5" 
            animation="property: scale; from:1 0 1; to: 1 1 1; easing: linear; dur: 1500; loop: 1; autoplay: true; delay: 10000">
        </a-entity> -->

        <!-- Crea el cielo del entorno virtual -->
        <a-entity 
            id="ambiente" 
            environment="preset:default; ground:none; ">
        </a-entity>
    </a-scene>

    <!-- Normal HTML -->

    <!-- Cabecera -->
    <div class="o-header">
        <h1>Aplicación</h1>
        <div class="o-optionsBtns">
            <div id="infoButton" class="o-crcButton" onclick="reveal()" >
                <span id="infoIcon" class="material-icons o-closed" style="font-size:24px;">help_outline</span>
            </div>
            <div class="o-sound" onmouseover="volumeControl()" onmouseout="quitVolumeControl()">
                <div id="soundButton" class="o-crcButton" onclick="updateSound()" >
                    <span id="soundIcon" class="material-icons o-closed" style="font-size:24px;">volume_off</span>
                </div>
                <input id="volumeSlider" type="range" min="0" max="100" value="50" class="o-volumeSlider">
            </div>
        </div>

    </div>
    <audio id="factorySound" loop>
        <source src="resources/Audio_files/Ambiente.ogg" type="audio/ogg">
    </audio>

    <!-- Información de los controles -->
    <div id="controlsContainer" class="o-controlsInfo">
        <p>Usa alguna de las siguientes combinaciones de teclas para moverte por el entorno</p>
        <div class="o-keyOptions">
            <div class="o-keys">
                <div class="o-key">A</div>
                <div class="o-key">W</div>
                <div class="o-key">D</div>
            </div>
            <div class="o-keys">
                <div class="o-key">&#129080</div>
                <div class="o-key">&#129081</div>
                <div class="o-key">&#129082</div>
            </div>
        </div>
    </div>

    <!-- Información del laboratorio -->
    <div id="container" class="o-container">
        <div id="info-01" class="o-information">
            <h3>Ingeniero jefe dice:</h3>
            <p>Bienvenido ingenier@, el día de hoy la práctica esta enfocada en las siete herramientas estadísticas</p>
            <button class="o-principal" onclick="nextText()">Continuar</button>
        </div>
        <div id="info-02" class="o-information" style="display: none;">
            <h3>Ingeniero jefe dice:</h3>
            <p>Deberas de inspeccionar todos los productos suministrados y anotar sus caracteristicas en el formato para poder aplicar las herramientas solicitadas</p>
            <button class="o-principal" onclick="nextText()">Continuar</button>
        </div>
        <div id="info-03" class="o-information" style="display: none;">
            <h3>Ingeniero jefe dice:</h3>
            <p>Para un mejor entendimiento del proceso, visualiza el video a continuación</p>
            <div class="o-desitionButtons">
                <button class="o-secundario" onclick="openVideo()">Ver video</button>
                <button id="nextButton" class="o-principal" onclick="nextText()" disabled>Continuar</button>
            </div>
        </div>
        <div id="info-04" class="o-information" style="display: none;">
            <h3>Ingeniero jefe dice:</h3>
            <p>Ahora dirigete a tu estación de trabajo haciendo click sobre el portal a tu derecha</p>
            <button class="o-principal" onclick="endText()">Hasta luego</button>
        </div>
    </div>
    <div id="videoModal" class="o-modal">
        <div class="o-modalContent">
            <video id="video" src="resources/Videos/Miss_Minutes_TVA.mp4" width="60%" heigth="60%" type="video/mp4"></video>
            <div id="closeButton" class="o-close" onclick="closeVideo()">
                <span class="material-icons o-closed" style="font-size:24px;">close</span>
            </div>
        </div>
    </div>

</body>
</html>